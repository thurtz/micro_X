

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>utils.dev &mdash; micro_X 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            micro_X
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">micro_X</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">utils.dev</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for utils.dev</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span> <span class="c1"># Added for loading configuration</span>

<span class="c1"># --- Help Text ---</span>
<span class="n">HELP_TEXT</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">micro_X Help: Developer &amp; Contribution Guide</span>

<span class="s2">This utility manages the multi-branch development environment, allowing you to run commands across the main, testing, and dev branches.</span>

<span class="s2">Usage:</span>
<span class="s2">  /dev &lt;option&gt;</span>

<span class="s2">Environment Setup:</span>
<span class="s2">  --activate              - Clones and sets up the &#39;testing&#39; and &#39;dev&#39; branches into subdirectories.</span>

<span class="s2">Updating Branches:</span>
<span class="s2">  --update-all            - Pulls the latest changes for both the &#39;testing&#39; and &#39;dev&#39; branches.</span>
<span class="s2">  --update-testing        - Pulls the latest changes for only the &#39;testing&#39; branch.</span>
<span class="s2">  --update-dev            - Pulls the latest changes for only the &#39;dev&#39; branch.</span>

<span class="s2">Snapshot Generation:</span>
<span class="s2">  --snapshot-main [args]  - Generates a snapshot from the main branch.</span>
<span class="s2">  --snapshot-testing [args] - Generates a snapshot from the testing branch.</span>
<span class="s2">  --snapshot-dev [args]   - Generates a snapshot from the dev branch.</span>
<span class="s2">  --snapshot-all [args]   - Generates snapshots for all three branches.</span>

<span class="s2">Running Tests:</span>
<span class="s2">  --run-tests-main        - Runs the test suite in the main branch environment.</span>
<span class="s2">  --run-tests-testing     - Runs the test suite in the testing branch environment.</span>
<span class="s2">  --run-tests-dev         - Runs the test suite in the dev branch environment.</span>
<span class="s2">  --run-tests-all         - Runs the test suites for all three branches.</span>

<span class="s2">Documentation:</span>
<span class="s2">  --update-docs           - Builds the documentation in the dev branch.</span>
<span class="s2">  --update-docs-kb        - Updates the knowledge base for the micro_X documentation.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># --- Configuration ---</span>
<span class="n">TESTING_BRANCH_DIR_NAME</span> <span class="o">=</span> <span class="s2">&quot;micro_X-testing&quot;</span>
<span class="n">DEV_BRANCH_DIR_NAME</span> <span class="o">=</span> <span class="s2">&quot;micro_X-dev&quot;</span>
<span class="n">GIT_REPO_URL</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/thurtz/micro_X.git&quot;</span>
<span class="n">DEFAULT_CONFIG_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;default_config.json&quot;</span>
<span class="n">USER_CONFIG_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;user_config.json&quot;</span>
<span class="n">CONFIG_DIR_NAME</span> <span class="o">=</span> <span class="s2">&quot;config&quot;</span>


<span class="c1"># --- Logging Setup ---</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
<span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="find_environment_root">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.find_environment_root">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_environment_root</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the root of the multi-branch environment by traversing upwards</span>
<span class="sd">    from the current script&#39;s location. The root is the directory that IS the main</span>
<span class="sd">    branch and CONTAINS the testing and dev branch directories.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="c1"># Limit upward traversal to prevent infinite loops in unexpected structures</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="c1"># A directory is the environment root if it has its own main.py</span>
        <span class="c1"># and contains the testing and dev subdirectories.</span>
        <span class="n">main_py_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="s2">&quot;main.py&quot;</span><span class="p">)</span>
        <span class="n">testing_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">)</span>
        <span class="n">dev_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">main_py_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">testing_dir_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dev_dir_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">current_path</span>

        <span class="n">parent_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">current_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_path</span> <span class="o">==</span> <span class="n">current_path</span><span class="p">:</span>  <span class="c1"># Reached the filesystem root</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">current_path</span> <span class="o">=</span> <span class="n">parent_path</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># --- START: Added configuration loading functions ---</span>
<div class="viewcode-block" id="merge_configs">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.merge_configs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_configs</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">override</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Helper function to recursively merge dictionaries. &quot;&quot;&quot;</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">override</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">merged</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_configs</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">merged</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">merged</span></div>


<div class="viewcode-block" id="load_configuration">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.load_configuration">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">load_configuration</span><span class="p">(</span><span class="n">project_root</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads configurations from default and user JSON files for this utility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">CONFIG_DIR_NAME</span><span class="p">,</span> <span class="n">DEFAULT_CONFIG_FILENAME</span><span class="p">)</span>
    <span class="n">user_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">CONFIG_DIR_NAME</span><span class="p">,</span> <span class="n">USER_CONFIG_FILENAME</span><span class="p">)</span>

    <span class="n">base_config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">default_config_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">default_config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">base_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error loading default configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># Cannot proceed without a base config</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Error: Default configuration file not found. Cannot determine activation rules.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">user_config_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">user_config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">user_settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">merge_configs</span><span class="p">(</span><span class="n">base_config</span><span class="p">,</span> <span class="n">user_settings</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è Warning: Could not load or parse user config. Using defaults only. Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">base_config</span></div>

<span class="c1"># --- END: Added configuration loading functions ---</span>


<div class="viewcode-block" id="run_command">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.run_command">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">capture</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a command, allowing it to interact directly with the terminal by default,</span>
<span class="sd">    and handles errors. Can optionally capture output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running command for &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--&gt; Running: </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">capture</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">command</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output from &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stderr from &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;:</span><span class="se">\n</span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Success: </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2"> completed.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Success: </span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2"> completed.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;: Command &#39;</span><span class="si">{</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Command &#39;</span><span class="si">{</span><span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; not found. Is it installed and in your PATH?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39; (return code </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ùå Error during &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;. The command failed with return code </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- stdout ---</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stdout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- stderr ---</span><span class="se">\n</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå An unexpected error occurred during &#39;</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="activate_dev_environment">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.activate_dev_environment">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">activate_dev_environment</span><span class="p">(</span><span class="n">project_root</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clones and sets up the testing and dev branches.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üöÄ Activating micro_X development environment...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This process will be interactive as it runs the setup scripts.&quot;</span><span class="p">)</span>

    <span class="c1"># --- START: Updated branch check logic ---</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Step 1/5] Verifying current branch...&quot;</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_configuration</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">return</span> <span class="c1"># Stop if config loading failed</span>

    <span class="n">allowed_branches</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;integrity_check&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dev_activation_allowed_branches&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;git&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Error: &#39;git&#39; command not found. Please install Git and ensure it&#39;s in your PATH.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="s1">&#39;--abbrev-ref&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">],</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">project_root</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">current_branch</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_branch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_branches</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: For safety, this utility can only be run from specific branches.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   You are currently on: &#39;</span><span class="si">{</span><span class="n">current_branch</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Allowed branches are configured as: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allowed_branches</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   You can change this in your &#39;user_config.json&#39; file if needed.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Success: Currently on &#39;</span><span class="si">{</span><span class="n">current_branch</span><span class="si">}</span><span class="s2">&#39; branch (which is allowed).&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error checking current branch: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># --- END: Updated branch check logic ---</span>

    <span class="c1"># 2. Clone Branches</span>
    <span class="n">branches_to_clone</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Step 2/5] Cloning development branches...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">target_dir</span> <span class="ow">in</span> <span class="n">branches_to_clone</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Setting up &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; branch ---&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Directory &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; already exists. Skipping clone.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">clone_command</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;clone&#39;</span><span class="p">,</span> <span class="s1">&#39;--branch&#39;</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">GIT_REPO_URL</span><span class="p">,</span> <span class="n">target_dir</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run_command</span><span class="p">(</span><span class="n">clone_command</span><span class="p">,</span> <span class="n">project_root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cloning </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2"> branch&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Halting due to error cloning &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="c1"># 3. Install Dependencies for each branch</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Step 3/5] Installing dependencies via setup.sh...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">target_dir</span> <span class="ow">in</span> <span class="n">branches_to_clone</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Installing for &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; branch in &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/&#39; ---&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Directory &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; not found. Skipping dependency installation.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">setup_script_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="s1">&#39;setup.sh&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">setup_script_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: &#39;setup.sh&#39; not found in &#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;. Cannot install dependencies.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">setup_script_path</span><span class="p">,</span> <span class="mo">0o755</span><span class="p">)</span>
        <span class="n">install_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">setup_script_path</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run_command</span><span class="p">(</span><span class="n">install_command</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Running setup for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Halting due to error installing dependencies for &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="c1"># 4. Setup Development Environment Dependencies</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Step 4/5] Setting up development tools (pytest, etc.)...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">target_dir</span> <span class="ow">in</span> <span class="n">branches_to_clone</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Setting up dev tools for &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; branch ---&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">python_executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
        <span class="n">setup_dev_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">,</span> <span class="s1">&#39;setup_dev_env.py&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">python_executable</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">setup_dev_script</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Dev environment for &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; is incomplete. Python executable or setup script missing.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">dev_setup_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">python_executable</span><span class="p">,</span> <span class="n">setup_dev_script</span><span class="p">]</span>
        <span class="n">run_command</span><span class="p">(</span><span class="n">dev_setup_command</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Running dev setup for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># 5. Final Summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Step 5/5] Summary&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Development environment activation complete.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">TESTING_BRANCH_DIR_NAME</span><span class="si">}</span><span class="s2">/ (testing branch)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">DEV_BRANCH_DIR_NAME</span><span class="si">}</span><span class="s2">/ (dev branch)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You can now use &#39;/utils dev --update-all&#39; or &#39;/utils dev --snapshot-dev&#39;.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_single_branch">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.update_single_branch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_single_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">branch_dir_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pulls the latest changes for a single specified branch installation.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Updating &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; branch ---&quot;</span><span class="p">)</span>
    <span class="n">target_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">branch_dir_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">target_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Directory &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; not found. Skipping update.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">pull_command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;pull&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">]</span>
    <span class="n">run_command</span><span class="p">(</span><span class="n">pull_command</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pulling updates for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="snapshot_for_branch">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.snapshot_for_branch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">branch_project_root_path</span><span class="p">,</span> <span class="n">extra_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a snapshot from a specified branch, passing along extra arguments.&quot;&quot;&quot;</span>
    <span class="n">branch_dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üì∏ Generating snapshot from the &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; environment...&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Directory &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">branch_name</span> <span class="o">!=</span> <span class="s1">&#39;main&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;/utils dev --activate&#39; first.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">python_executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">snapshot_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">,</span> <span class="s1">&#39;generate_snapshot.py&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">python_executable</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">snapshot_script</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Environment for &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; is incomplete. Python executable or snapshot script is missing.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">snapshot_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">python_executable</span><span class="p">,</span> <span class="n">snapshot_script</span><span class="p">]</span>
    <span class="n">snapshot_command</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_args</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;--summary&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;-s&#39;</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">extra_args</span><span class="p">):</span>
        <span class="n">snapshot_command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--summary&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Generated from main branch for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s1"> branch&#39;</span><span class="p">])</span>

    
    <span class="n">output</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">snapshot_command</span><span class="p">,</span> <span class="n">branch_project_root_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Generating snapshot for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">capture</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Snapshot generation failed.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">created_file_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Successfully generated snapshot:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">created_file_path</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">break</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">created_file_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">created_file_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Could not determine the created snapshot filename from the script output.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">snapshot_sub_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s1">&#39;snapshots&#39;</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">snapshot_sub_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">created_file_path</span><span class="p">,</span> <span class="n">snapshot_sub_dir</span><span class="p">)</span>
        <span class="n">final_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">snapshot_sub_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">created_file_path</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ Snapshot successfully generated and moved to the main project&#39;s snapshot directory.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   File: </span><span class="si">{</span><span class="n">final_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error moving snapshot file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="run_tests_for_branch">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.run_tests_for_branch">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">branch_name</span><span class="p">,</span> <span class="n">branch_project_root_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs the test suite for a specified branch installation.&quot;&quot;&quot;</span>
    <span class="n">branch_dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üß™ Running test suite for the &#39;</span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&#39; environment...&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Directory &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">branch_name</span> <span class="o">!=</span> <span class="s1">&#39;main&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;/utils dev --activate&#39; first.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">python_executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">run_tests_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">branch_project_root_path</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">,</span> <span class="s1">&#39;run_tests.py&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">python_executable</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">run_tests_script</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: &#39;</span><span class="si">{</span><span class="n">branch_dir_name</span><span class="si">}</span><span class="s2">&#39; environment is incomplete. Python executable or run_tests.py is missing.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;./setup_main_for_dev.sh&#39; for the main branch, or check the sub-directory setups.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">test_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">python_executable</span><span class="p">,</span> <span class="n">run_tests_script</span><span class="p">]</span>
    
    <span class="n">run_command</span><span class="p">(</span><span class="n">test_command</span><span class="p">,</span> <span class="n">branch_project_root_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Running tests for </span><span class="si">{</span><span class="n">branch_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_docs">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.update_docs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_docs</span><span class="p">(</span><span class="n">environment_root</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds the Sphinx documentation in the dev branch.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üìö Building documentation in the &#39;dev&#39; branch environment...&quot;</span><span class="p">)</span>

    <span class="n">dev_branch_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: &#39;dev&#39; branch directory not found at &#39;</span><span class="si">{</span><span class="n">dev_branch_dir</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;/dev --activate&#39; first.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Run make command in the dev branch directory</span>
    <span class="n">docs_source_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">docs_source_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Documentation source directory not found in &#39;dev&#39; branch at &#39;</span><span class="si">{</span><span class="n">docs_source_dir</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">make_command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="n">docs_source_dir</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">run_command</span><span class="p">(</span><span class="n">make_command</span><span class="p">,</span> <span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s2">&quot;Building Sphinx documentation for dev branch&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ Documentation build complete in the &#39;dev&#39; branch.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   You can view the updated docs by running micro_X from the &#39;</span><span class="si">{</span><span class="n">DEV_BRANCH_DIR_NAME</span><span class="si">}</span><span class="s2">&#39; directory and using &#39;/docs&#39;.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="update_docs_knowledge_base">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.update_docs_knowledge_base">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_docs_knowledge_base</span><span class="p">(</span><span class="n">environment_root</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the knowledge base for the micro_X documentation in the dev branch.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üß† Updating documentation knowledge base in the &#39;dev&#39; branch environment...&quot;</span><span class="p">)</span>

    <span class="n">dev_branch_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: &#39;dev&#39; branch directory not found at &#39;</span><span class="si">{</span><span class="n">dev_branch_dir</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;/dev --activate&#39; first.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">python_executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s1">&#39;.venv&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span>
    <span class="n">knowledge_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">,</span> <span class="s1">&#39;knowledge.py&#39;</span><span class="p">)</span>
    <span class="n">docs_html_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">python_executable</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">knowledge_script</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: &#39;dev&#39; environment is incomplete. Python executable or knowledge.py is missing.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">docs_html_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Error: Documentation HTML directory not found in &#39;dev&#39; branch at &#39;</span><span class="si">{</span><span class="n">docs_html_dir</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Please run &#39;/dev --update-docs&#39; first to build the documentation.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">kb_command</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">python_executable</span><span class="p">,</span>
        <span class="n">knowledge_script</span><span class="p">,</span>
        <span class="s1">&#39;add-dir&#39;</span><span class="p">,</span>
        <span class="n">docs_html_dir</span><span class="p">,</span>
        <span class="s1">&#39;--name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;micro_X_docs&#39;</span>
    <span class="p">]</span>
    
    <span class="k">if</span> <span class="n">run_command</span><span class="p">(</span><span class="n">kb_command</span><span class="p">,</span> <span class="n">dev_branch_dir</span><span class="p">,</span> <span class="s2">&quot;Updating micro_X_docs knowledge base&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ Documentation knowledge base update complete.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../api_reference.html#utils.dev.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function to parse arguments and execute logic.&quot;&quot;&quot;</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">HelpAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_strings</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">HelpAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">option_strings</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">HELP_TEXT</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Manage the micro_X multi-branch development environment.&quot;</span><span class="p">,</span>
        <span class="n">add_help</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">HelpAction</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;show this help message and exit&#39;</span><span class="p">)</span>

    <span class="c1"># --- Group for exclusive actions ---</span>
    <span class="n">action_group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--activate&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Clones and sets up the &#39;testing&#39; and &#39;dev&#39; branches into subdirectories.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--update-all&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pulls the latest changes for both the &#39;testing&#39; and &#39;dev&#39; branch installations.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--update-testing&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pulls the latest changes for only the &#39;testing&#39; branch installation.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--update-dev&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Pulls the latest changes for only the &#39;dev&#39; branch installation.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--snapshot-main&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generates a snapshot from the main branch. All following arguments are passed to generate_snapshot.py.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--snapshot-testing&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generates a snapshot from the testing branch. All following arguments are passed to generate_snapshot.py.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--snapshot-dev&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generates a snapshot from the dev branch. All following arguments are passed to generate_snapshot.py.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--snapshot-all&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">REMAINDER</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generates snapshots for main, testing, and dev branches. Following arguments are passed to all.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--run-tests-main&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Runs the test suite located in the main branch environment.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--run-tests-dev&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Runs the test suite located in the dev branch environment.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--run-tests-testing&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Runs the test suite located in the testing branch environment.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--run-tests-all&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Runs the test suites for the main, testing, and dev branches.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--update-docs&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Builds the documentation in the dev branch.&quot;</span>
    <span class="p">)</span>
    <span class="n">action_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--update-docs-kb&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Updates the knowledge base for the micro_X documentation.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># If no arguments are provided, print help text</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">HELP_TEXT</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    
    <span class="n">environment_root</span> <span class="o">=</span> <span class="n">find_environment_root</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">environment_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Fallback for when the script is run from a non-activated environment</span>
        <span class="c1"># This allows --activate to still work</span>
        <span class="n">project_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">activate</span><span class="p">:</span>
             <span class="n">activate_dev_environment</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span>
             <span class="k">return</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Error: Could not find the micro_X multi-branch environment root.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Ensure you are running this from within an activated environment, or run &#39;/dev --activate&#39; from the main branch.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Get the name of the main branch directory, which might be different from the env root basename</span>
    <span class="n">main_branch_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">)</span>

    <span class="c1"># Execute the chosen action</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">activate</span><span class="p">:</span>
        <span class="c1"># The activate command should be run from the main branch directory</span>
        <span class="n">activate_dev_environment</span><span class="p">(</span><span class="n">main_branch_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">update_all</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üîÑ Updating all development environment branches...&quot;</span><span class="p">)</span>
        <span class="n">update_single_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">)</span>
        <span class="n">update_single_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ All development branches have been updated.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">update_testing</span><span class="p">:</span>
        <span class="n">update_single_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">update_dev</span><span class="p">:</span>
        <span class="n">update_single_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_main</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">main_branch_dir</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_main</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_testing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_testing</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_dev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_dev</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üì∏ Generating snapshots for all branches...&quot;</span><span class="p">)</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">main_branch_dir</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_all</span><span class="p">)</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_all</span><span class="p">)</span>
        <span class="n">snapshot_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">snapshot_all</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ All snapshots generated.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">run_tests_main</span><span class="p">:</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">main_branch_dir</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">run_tests_dev</span><span class="p">:</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">run_tests_testing</span><span class="p">:</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">run_tests_all</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üß™ Running test suites for all branches...&quot;</span><span class="p">)</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">main_branch_dir</span><span class="p">)</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">TESTING_BRANCH_DIR_NAME</span><span class="p">))</span>
        <span class="n">run_tests_for_branch</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">environment_root</span><span class="p">,</span> <span class="n">DEV_BRANCH_DIR_NAME</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚úÖ All test suites have been run.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">update_docs</span><span class="p">:</span>
        <span class="n">update_docs</span><span class="p">(</span><span class="n">environment_root</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">update_docs_kb</span><span class="p">:</span>
        <span class="n">update_docs_knowledge_base</span><span class="p">(</span><span class="n">environment_root</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, micro_X Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>